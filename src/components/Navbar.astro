---
import LogoSolidGroundAviation from "../components/LogoSolidGroundAviation.astro";

export type MenuItem = {
  label: string;
  url: string;
  children?: MenuItem[];
};

export type NavbarButton = {
  text: string;
  href: string;
  style: "btn-main" | "btn-second" | "btn-enroll";
};

export const menu: MenuItem[] = [
  { label: "Home", url: "#", children: [{ label: "Solid Ground Aviation", url: "/" }, { label: "Flight Animation", url: "/homepage-animation" }] },
  { label: "About Us", url: "#", children: [{ label: "About Us", url: "/#" }, { label: "Team", url: "/#" },{ label: "Partners", url: "/#" }, { label: "FAQ", url: "/#" }, { label: "Blog", url: "/#" }] },
  { label: "Training", url: "#", children: [{ label: "Ground School", url: "/#" }, { label: "Student Pilots", url: "/#" }, { label: "Licensed Pilots", url: "/#" }, { label: "Instrument Currency", url: "/#" }] },
];

export const buttons: NavbarButton[] = [
  { text: "Enroll Now", href: "/##", style: "btn-primary text-lg!" },
];
---

<nav id="navbar" class="navbar">
  <div class="container">
    <!-- Logo -->
    <a href="/" class="logo object-contain w-36 md:w-52 h-auto">
      <LogoSolidGroundAviation />
    </a>

    <!-- Desktop Menu -->
    <ul class="nav">
      {menu.map((item, index) => (
        <li class={`menu-item ${item.children ? "has-children" : ""}`} data-index={index}>
          <a href={item.url}>{item.label}</a>
          {item.children && (
            <ul class="sub-menu">
              {item.children.map((child) => (
                <li><a href={child.url}>{child.label}</a></li>
              ))}
            </ul>
          )}
        </li>
      ))}
    </ul>

    <!-- Buttons -->
    <div class="buttons">
      {buttons.map((button) => (
        <a href={button.href} class={button.style}>{button.text}</a>
      ))}
    </div>

    <!-- Mobile Hamburger -->
    <button id="mobile-toggle" class="hamburger" aria-label="Toggle menu">
      <span class="bar top"></span>
      <span class="bar middle"></span>
      <span class="bar bottom"></span>
    </button>
    
  </div>

  <!-- Mobile Menu -->
  <div id="mobile-menu" class="mobile-menu ">
    <ul>
      {menu.map((item, index) => (
        <li class="mobile-item" data-index={index}>
          <a href={item.url}>{item.label}</a>
          {item.children && (
            <ul class="mobile-submenu">
              {item.children.map((child) => (
                <li><a href={child.url}>{child.label}</a></li>
              ))}
            </ul>
          )}
        </li>
      ))}
    </ul>

    <div class="mobile-buttons">
      {buttons.map((button) => (
        <a href={button.href} class={button.style}>{button.text}</a>
      ))}
    </div>
  </div>
</nav>

<style>
.navbar {
  position: fixed;
  top: 0;
  width: 100%;
  z-index: 50;
  display: flex;
  justify-content: center;
  transition: all 0.5s ease;
}
.navbar.scrolled {
  background: rgba(255, 255, 255, 0.6);
  backdrop-filter: blur(8px);
  box-shadow: 0 4px 8px rgba(0,0,0,0.05);
}

.container {
  max-width: 1200px;
  width: 100%;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0.5rem 1rem;
}

.nav {
  display: flex;
  gap: 2rem;
  list-style: none;
}
.menu-item { 
  position: relative; 
  color: white; 
  transition: color 0.3s ease;
}
.menu-item a {
  font-weight: 500;
  text-transform: uppercase;
  transition: all 0.3s ease;
}
.menu-item a:hover {
  text-decoration: underline;
  text-underline-offset: 2px;
  color: oklch(83.7% 0.128 66.29);
}
.navbar.scrolled .menu-item { color: oklch(62.3% 0.214 259.815); }
.navbar.scrolled .menu-item a { color: oklch(62.3% 0.214 259.815); }
.navbar.scrolled .nav > .menu-item > a:hover {
  color: #e06900;
}

/* Force submenu hover to stay white when scrolled */
.navbar.scrolled .sub-menu li a:hover {
  color: #fff;                /* text stays white */
  background: #007ecb;        /* your existing submenu hover bg */
}

/* Dropdown (desktop) */
.sub-menu {
  position: absolute;
  top: 100%;
  left: 0;
  z-index: 40;
  min-width: 220px;

  background: #fff;
  border: 1px solid #ddd;
  list-style: none;
  padding: 0.5rem 0;

  /* no display:none — use visibility + opacity to avoid hover gaps */
  visibility: hidden;
  opacity: 0;
  transform: translateY(6px);
  pointer-events: none;

  /* 0.3s transition as requested */
  transition:
    opacity .3s ease,
    transform .3s ease,
    visibility .3s step-end; /* hide clicks when closed */
}

/* Show on hover */
.menu-item:hover .sub-menu {
  visibility: visible;
  opacity: 1;
  transform: translateY(0);
  pointer-events: auto;
  transition:
    opacity .3s ease,
    transform .3s ease,
    visibility .3s step-start; /* become clickable immediately */
}

/* Small invisible “bridge” to prevent hover loss between item and submenu */
.menu-item {
  position: relative;
}
.menu-item::after {
  content: "";
  position: absolute;
  left: 0;
  right: 0;
  top: 100%;
  height: 10px;          /* adjust if you like */
  background: transparent;
}

/* Dropdown items */
.sub-menu li a {
  display: block;
  padding: 0.5rem 1rem;
  white-space: nowrap;
  color: oklch(62.3% 0.214 259.815);
  transition: background .3s ease, color .3s ease, transform .3s ease;
}
.sub-menu li a:hover {
  background: #007ecb;
  color: #fff;
  transform: scale(1.05);
}

.buttons a {
  margin-left: 1rem;
  padding: 0.5rem 1rem;
  border-radius: 1.5rem;
  text-decoration: none;
  transition: all 0.3s ease;
}
.buttons a:hover { filter: brightness(1.1);}

.hamburger {
  display: none;
  flex-direction: column;
  gap: 4px;
  background: none;
  border: none;
  cursor: pointer;
}
.bar { width: 24px; height: 2px; background: #333; transition: all 0.3s ease; }

/* Mobile sheet (base) */
.mobile-menu {
  position: absolute;
  width: 100%;
  height: 100vh;
  top: 100%;
  left: 0;
  width: 100%;
  background: #fff;
  padding: 0 1rem;
  max-height: 0;
  overflow: hidden;
  transition: all 0.5s ease;
}
.mobile-menu.open {
  padding-top: 1rem;
  padding-bottom: 1rem;
  max-height: 100vh;
  overflow: visible;
}

/* Mobile submenu animation (base) */
.mobile-submenu {
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.5s ease, opacity 0.3s ease;
  opacity: 0;
}
.mobile-submenu.open {
  max-height: 20rem;
  opacity: 1;
}

/* ===== MOBILE-ONLY CHANGES BELOW ===== */
@media (max-width: 768px) {
  .nav, .buttons { display: none; }
  .hamburger { display: flex; }

  /* Closed state: no vertical padding, zero height */
  .mobile-menu {
    position: absolute;
    top: 100%;
    left: 0;
    width: 100%;
    background: #fff;
    padding: 0 16px;              /* was 12px 16px -> remove vertical padding */
    max-height: 0;                /* keep collapsed */
    overflow: hidden;             /* hide content */
    transition: max-height 0.5s ease, padding 0.3s ease;
  }

  /* Open state: add vertical padding + usable height */
  .mobile-menu.open {
    padding-top: 12px;            /* only when open */
    padding-bottom: 14px;         /* only when open */
    max-height: calc(100vh - 64px);
    overflow: auto;
  }

  /* Parent rows: larger tap targets + right chevron */
  .mobile-item > a {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 12px 4px;
    font-weight: 600;
    color: #111827;
  }
  .mobile-item > a::after {
    content: "▸";
    margin-left: 0.5rem;
    transition: transform 0.25s ease;
  }
  .mobile-item > a.open::after { transform: rotate(90deg); }

  /* Submenu styling */
  .mobile-submenu {
    border-left: 2px solid #e5e7eb;
    margin-left: 10px;
    padding-left: 6px;
  }
  .mobile-submenu li a {
    display: block;
    padding: 10px 12px 10px 24px;
    border-radius: 6px;
    color: #374151;
  }
  .mobile-submenu li a:hover { background: #f3f4f6; }

  /* Sticky full-width CTA */
  .mobile-buttons {
    position: sticky;
    bottom: 0;
    background: #fff;
    padding: 12px 0 14px;
    border-top: 1px solid #e5e7eb;
  }
  .mobile-buttons a { width: 100%; display: block; text-align: center; }

  /* Hamburger contrast */
  .navbar:not(.scrolled) .bar { background: #fff; }
  .navbar.scrolled .bar { background: #333; }
}
</style>

<script type="module">
  const navbar = document.getElementById("navbar");
  const mobileToggle = document.getElementById("mobile-toggle");
  const mobileMenu = document.getElementById("mobile-menu");

  // Scroll effect
  window.addEventListener("scroll", () => {
    if (window.scrollY > 40) {
      navbar.classList.add("scrolled");
    } else {
      navbar.classList.remove("scrolled");
    }
  });

  // Mobile menu open/close
  mobileToggle?.addEventListener("click", () => {
    mobileMenu?.classList.toggle("open");
  });

  // Mobile submenu toggles (tweak: mark link .open and animate height)
  const mobileItems = document.querySelectorAll(".mobile-item");
  mobileItems.forEach((item) => {
    const link = item.querySelector(":scope > a");
    const submenu = item.querySelector(".mobile-submenu");
    if (submenu && link) {
      link.addEventListener("click", (e) => {
        e.preventDefault(); // prevent navigation if it has children
        const isOpen = submenu.classList.contains("open");
        submenu.classList.toggle("open");
        link.classList.toggle("open");

        // Smooth height animation
        if (!isOpen) {
          submenu.style.maxHeight = submenu.scrollHeight + "px";
          submenu.style.opacity = "1";
        } else {
          submenu.style.maxHeight = "0px";
          submenu.style.opacity = "0";
        }
      });
    }
  });
</script>
